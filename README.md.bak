# 仓库管理系统 (Warehouse Management System)

## 概述

这是一个基于Web的仓库管理系统，支持中文界面，具备完整的库存管理功能，包括物品的增删改查、拼音搜索等特性。系统采用了现代化的技术栈，包含安全的用户认证机制。

## 功能特性

- **用户认证系统**：安全的注册和登录功能，支持注册Token验证
- **库存管理**：添加、删除、更新和查询库存物品
- **智能搜索**：支持按名称、拼音及拼音首字母搜索物品
- **响应式设计**：适配不同屏幕尺寸的设备
- **数据持久化**：本地JSON文件存储
- **安全防护**：防暴力破解、SQL注入和XSS攻击

## 技术栈

- **后端**：Node.js + Express
- **前端**：HTML5 + CSS3 + JavaScript (ES6+)
- **数据库**：JSON文件存储
- **安全**：JWT、bcrypt、防注入
- **拼音处理**：pinyin库

## 安装和部署

### 环境要求

- Node.js v14.0 或更高版本
- npm (随Node.js一起安装)

### 安装步骤

1. **克隆项目**
   ```bash
   git clone <repository-url>
   cd 3ei-InventoryMaster
   ```

2. **安装依赖**
   ```bash
   npm install
   ```

3. **启动服务器**
   ```bash
   npm start
   # 或者
   node server.js
   ```

4. **访问应用**
   打开浏览器，访问 `http://localhost:3000/login`

## 使用说明

### 初始设置

1. **生成注册Token**
   ```bash
   node generate-token.js
   ```
   这将生成一个24小时内有效的注册Token。

2. **注册账户**
   - 访问 `http://localhost:3000/login`
   - 点击"点击这里注册"
   - 输入用户名、密码和有效的注册Token
   - 完成注册后，您就可以使用账户登录系统

### 系统功能

#### 1. 库存管理
- **添加物品**：点击"添加物品"按钮，填写物品名称和数量
- **编辑数量**：点击物品行中的数量单元格，直接编辑数量
- **删除物品**：点击物品行右侧的删除按钮

#### 2. 搜索功能
- 系统支持多种搜索方式：
  - 直接搜索物品名称
  - 拼音搜索（如搜索"bijiben"可找到"笔记本"）
  - 拼音首字母搜索（如搜索"bjb"可找到"笔记本"）

#### 3. 数据持久化
- 所有数据保存在 `warehouse-data.json` 文件中
- 数据在每次操作后自动保存

### 安全特性

#### 1. 用户认证
- 所有API端点均受JWT令牌保护
- 防暴力破解：连续5次登录失败后，IP将被临时封禁30分钟
- 密码使用bcrypt加密存储

#### 2. 输入验证
- 所有用户输入都会经过验证和清理
- 防止SQL注入和XSS攻击
- 特殊字符会被过滤

#### 3. Token管理
- 注册Token有效期为24小时
- 每个Token只能使用一次
- 通过命令行生成Token，提高安全性

## 系统架构

### 前端组件
- `index.html`：主界面
- `login.html`：登录页面
- `register.html`：注册页面
- `script.js`：客户端业务逻辑
- `styles.css`：样式定义

### 后端组件
- `server.js`：Express服务器
- `auth.js`：身份验证系统
- `warehouse-data.json`：数据存储文件
- `users.json`：用户数据存储
- `tokens.json`：注册Token存储

### API端点

#### 认证相关
- `POST /api/login` - 用户登录
- `POST /api/register` - 用户注册
- `POST /api/generate-token` - 生成注册Token

#### 库存管理相关
- `GET /api/inventory` - 获取所有库存
- `POST /api/inventory` - 添加新物品
- `PUT /api/inventory/:id` - 更新物品数量
- `DELETE /api/inventory/:id` - 删除物品
- `GET /api/search/:query` - 搜索物品

## 配置选项

### 环境变量
系统支持以下环境变量：

- `JWT_SECRET`：JWT签名密钥（默认为硬编码字符串）
- `PORT`：服务器监听端口（默认为3000）

### 服务器配置
- 默认监听端口：3000
- 支持跨域请求(CORS)
- 静态文件服务

## 部署

### 本地部署
1. 确保已安装Node.js和npm
2. 按照安装步骤执行
3. 访问 `http://localhost:3000/login`

### 生产环境部署
1. 使用PM2进行进程管理：
   ```bash
   npm install -g pm2
   pm2 start server.js --name "warehouse-system"
   ```

2. 配置反向代理（如Nginx）
3. 设置SSL证书以启用HTTPS
4. 配置环境变量，特别是JWT_SECRET

## 维护和监控

### 日志
- 服务器启动时会在控制台输出运行信息
- 错误信息也会在控制台显示

### 数据备份
- 定期备份 `warehouse-data.json`、`users.json` 和 `tokens.json` 文件
- 建议设置自动化备份脚本

### 性能优化
- 对于大量数据，建议迁移到关系型数据库
- 使用缓存机制提高搜索性能
- 实施分页功能以处理大量数据

## 故障排除

### 常见问题

1. **无法访问登录页面**
   - 检查服务器是否已启动
   - 确认端口3000未被其他程序占用
   - 检查防火墙设置

2. **注册Token无效**
   - 确认Token未过期（24小时有效期）
   - 确认Token未被使用过
   - 检查Token输入是否正确

3. **登录失败**
   - 检查用户名和密码是否正确
   - 如果多次失败，确认IP未被暂时封禁

### 调试
- 检查服务器控制台输出
- 查看浏览器开发者工具中的网络请求
- 检查JSON数据文件格式是否正确

## 安全注意事项

- 生产环境中务必更改默认的JWT_SECRET
- 定期轮换注册Token
- 监控登录失败尝试
- 定期更新依赖包以获得安全补丁
- 使用HTTPS加密传输

## 贡献

欢迎提交Issue和Pull Request来帮助改进此项目。

## 许可证

[在此处添加许可证信息]

## 致谢

- Express.js框架
- pinyin库
- bcrypt用于密码加密
- JSON Web Token (JWT)